<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-sm border-0 mb-4 p-4 text-center bg-white rounded-4">
        <h1 class="fw-bold text-primary"><%= @survey.title %></h1>
        <p class="text-muted mb-0"><%= @survey.description %></p>
      </div>

      <%= form_with(model: @submission, url: submissions_path, local: true) do |f| %>
        <%= f.hidden_field :survey_id, value: @survey.id %>

        <% @survey.questions.each_with_index do |question, index| %>
          <div class="card shadow-sm border-0 mb-4 rounded-4 overflow-hidden">
            <div class="card-header bg-light py-3 border-0">
              <h5 class="mb-0 fw-bold">
                <span class="badge bg-primary me-2"><%= index + 1 %></span>
                <%= question.content %>
              </h5>
            </div>
            
            <div class="card-body p-4">
              <%# Находим объект ответа для текущего вопроса %>
              <%= f.fields_for :answers, @submission.answers.to_a[index] do |a_f| %>
                <%= a_f.hidden_field :question_id, value: question.id %>

                <% if question.single_choice? %>
                  <% question.options.each do |option| %>
                    <div class="form-check mb-3">
                      <%= a_f.radio_button :content, option.content, class: "form-check-input", id: "q_#{question.id}_o_#{option.id}" %>
                      <label class="form-check-label" for="q_<%= question.id %>_o_<%= option.id %>">
                        <%= option.content %>
                      </label>
                    </div>
                  <% end %>

                <% elsif question.multiple_choice? %>
                  <p class="text-muted small mb-3"><i>Можно выбрать несколько вариантов:</i></p>
                  <% question.options.each do |option| %>
                    <div class="form-check mb-3">
                      <%= a_f.check_box :content, { multiple: true, class: "form-check-input", id: "q_#{question.id}_o_#{option.id}" }, option.content, nil %>
                      <label class="form-check-label" for="q_<%= question.id %>_o_<%= option.id %>">
                        <%= option.content %>
                      </label>
                    </div>
                  <% end %>

                <% else %>
                  <%= a_f.text_area :content, class: "form-control", rows: 3, placeholder: "Напишите ваш ответ..." %>
                <% end %>
              <% end %>
            </div>
          </div>
        <% end %>

        <div class="d-grid gap-2 mb-5">
          <%= f.submit "Отправить опрос", class: "btn btn-primary btn-lg rounded-pill shadow" %>
          <%= link_to "Вернуться назад", surveys_path, class: "btn btn-link text-secondary" %>
        </div>
      <% end %>
    </div>
  </div>
</div>